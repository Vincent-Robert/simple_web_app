extends layout

block layout-content
  div.View.UserView
    h1.Banner Estimation du prix de la course
    div.Message
      div.Title
        h1 Ici Estimateur de prix 
        h3 
          | Les prix peuvent varier en fonction du 
          br
          | traffic et du temps d'attente
        br
        div
          label(for='depart') Départ : 
          input#depart(type='text', name='depart', placeholder="ville")
          br
          label(for='arrivee') Arrivée :
          input#arrivee(type='text', name='arrivee', placeholder="ville")
        div
          label(for="aller_retour") Aller Simple
          input#aller_retour(type="checkbox") 
        div
          label(for="jour_nuit") Dimanche, férié ou de nuit                       
          input#jour_nuit(type="checkbox") 
        div
          label(for="ferie") Dimanche ou férié
          input#ferie(type="checkbox") 
        br
        div
          button(onclick="SomeFunction()") Calculer
        h3#resultat
        br
        h3#prix
      //pre.Details=JSON.stringify(userProfile, null, 2)
    div.NavButtons
      a(href="/")
        div.NavButton Retour
        
  script.
    function SomeFunction() {
      var service = new google.maps.DistanceMatrixService();
      service.getDistanceMatrix({origins: [depart.value], destinations: [arrivee.value], travelMode: google.maps.TravelMode.DRIVING, unitSystem: google.maps.UnitSystem.METRIC}, callback_);
      function callback_(response, status) {
        if (status == 'OK') {
          var origins = response.originAddresses;
          var destinations = response.destinationAddresses;
          var element = response.rows[0].elements[0];
          var distance = element.distance.text;
          var duration = element.duration.text;
          var forfait_coeff_km = 0.95;
          if ((ferie.checked) || (jour_nuit.checked)){
            forfait_coeff_km = 1.43
          }
          if (aller_retour.checked){
            forfait_coeff_km = forfait_coeff_km*2
          }
          resultat.innerHTML = "Ca ferait " + distance + " ou " + duration;
          prix.innerHTML = "Soit " + Math.round(220 + 100*Math.max(7.30, parseInt(distance.split(" ")[0])*forfait_coeff_km))/100 + "€ environ"
        }
      }
    }
  script(src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDzsQHMLpMsDFANnWyvPsVECyMF9qO9Qh4")

